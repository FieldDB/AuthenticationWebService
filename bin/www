#!/usr/bin/env node

var config = require('config');
var https = require('https');
var url = require('url');

var service = require('../auth_service');
var server;

service.set('port', config.httpsOptions.port);

if (process.env.NODE_ENV === 'production') {
  service.listen(config.httpsOptions.port);
  debug('Running in production mode behind an Nginx proxy, Listening on http port %d', config.httpsOptions.port);
} else {
  /**
   * Read in the specified filenames for this config's security key and certificates,
   * and then ask https to turn on the webservice
   */
  server = https.createServer(config.httpsOptions, service).listen(service.get('port'), function() {
    console.log('HTTPS Express server listening on https://localhost:' + server.address().port);
  });
}

module.exports = {
  server: server,
  service: service,
};
